# 无债券全天候策略回测系统

## 项目概述

本项目实现了基于ETF的全天候投资策略回测系统。在缺少债券资产的约束下，通过因子选股和风险平价方法构建稳健的投资组合。

**核心特点**：
- 使用风险调整后动量因子进行资产筛选
- 对比等权和风险平价两种配置方法
- 完整的回测框架，包含交易成本模拟
- 初始资金：1亿元
- 交易费用：万分之2.5

---

## 数据说明

### 输入数据
1. **附件2**：ETF日频量价数据（开盘、收盘、高、低、成交量、成交额）
   - 28只ETF的日频行情数据
   - 字段：date, sec（证券代码）, close（收盘价）等

2. **附件3**：高频经济指标（信用利差、期限利差、汇率等）
   - 宏观经济环境指标
   - 用于情景分析和策略调整参考

### 数据处理
- 数据透视：转换为宽表格式（日期×证券代码）
- 缺失值处理：前向填充（ffill）处理停牌和节假日
- 时间对齐：确保所有ETF在同一时间维度

---

## 任务详解

### 任务一：因子构建 (Factor Construction)

**策略名称**：风险调整后动量因子（Risk Adjusted Momentum）

**核心逻辑**：
```
因子值 = 过去20日收益率 / 过去20日波动率
```

**设计思路**：
1. **动量项**：计算过去20个交易日（约1个月）的收益率
2. **风险项**：计算同期日收益率的标准差（波动率）
3. **风险调整**：用收益除以波动，筛选出"高夏普率"资产

**理论依据**：
- 在无风险资产（债券）缺失的情况下，该因子能自动向高风险调整收益的资产倾斜
- 避免了单纯追求高收益而忽视风险的问题
- 符合全天候策略"稳健收益"的核心理念

**输出**：每日每只ETF的因子得分

---

### 任务二：等权组合策略 (Equal Weight Portfolio)

**策略名称**：Task2_EqualWeight

**执行流程**：
1. **调仓频率**：每周一次（默认周一）
2. **资产筛选**：根据任务一的因子值，选出得分最高的5只ETF
3. **权重分配**：等权配置，每只ETF占20%
4. **再平衡**：每周调整至目标权重

**策略特点**：
- ✅ 简单直观，易于理解和执行
- ✅ 分散化程度较高
- ⚠️ 未考虑不同资产的风险差异
- ⚠️ 高波动资产可能拉高整体组合风险

**约束条件**：
- 持仓数量：5只ETF
- 单只权重：20%（1/5）

---

### 任务三：风险平价优化组合 (Risk Parity Portfolio)

**策略名称**：Task3_RiskParity

**核心算法**：倒数波动率加权（Inverse Volatility Weighting）

**执行流程**：
1. **调仓频率**：每周一次（默认周一）
2. **资产筛选**：同任务二，选出因子得分Top 5
3. **波动率计算**：
   - 提取过去30个交易日的价格数据
   - 计算每只ETF的日收益率标准差
4. **权重计算**：
   ```
   权重_i = (1/波动率_i) / Σ(1/波动率_j)
   ```
5. **约束处理**：
   - 单只资产权重上限：35%
   - 迭代截断归一化，确保满足约束
6. **再平衡**：调整至目标权重

**策略优势**：
- ✅ **风险均衡**：每只资产对组合波动的贡献相等
- ✅ **自适应调整**：波动率变化时自动调整权重
- ✅ **降低整体波动**：相比等权显著降低组合波动率
- ✅ **更符合全天候理念**：在不同市场环境下保持稳健

**与任务二的区别**：
| 维度 | 任务二（等权） | 任务三（风险平价） |
|------|----------------|-------------------|
| 权重分配 | 固定20% | 根据波动率动态调整 |
| 风险管理 | 无差异化 | 低波资产↑ 高波资产↓ |
| 组合波动 | 较高 | 较低 |
| 夏普比率 | 一般 | 预期更优 |

---

## 使用方法

### 环境要求
```bash
pip install bt pandas numpy matplotlib seaborn
```

### 运行代码
```bash
cd code
python main.py
```


## 输出结果

### 1. 策略绩效统计表
- 总收益率（Total Return）
- 年化收益率（CAGR）
- 最大回撤（Max Drawdown）
- 夏普比率（Sharpe Ratio）
- 波动率（Volatility）

### 2. 净值曲线对比图
展示两个策略的净值走势，直观对比表现差异

### 3. 持仓权重变化图
展示任务三风险平价策略的动态权重调整过程，验证"全天候"效果

---

## 核心创新点

1. **因子设计**：在无债券约束下，创造性地使用风险调整后动量替代传统收益指标
2. **风险管理**：引入风险平价思想，实现"低波稳健"的全天候特征
3. **约束优化**：通过迭代截断确保单只资产不超过35%，兼顾分散和集中

---

## 策略逻辑总结

**全天候策略的本质**：在不同宏观环境下都能获得稳健收益

**本项目的实现路径**：
1. ✅ 用因子选股替代资产类别配置（因为只有ETF）
2. ✅ 用风险平价替代固定权重（适应市场变化）
3. ✅ 用波动率约束替代债券配置（降低组合风险）

**预期效果**：相比等权策略，风险平价组合应表现出更低的波动率和更高的风险调整收益。

---

## 后续优化方向

1. **宏观情景切换**：利用附件3的经济指标，在不同经济周期调整选股数量和权重上限
2. **动态再平衡**：根据市场波动调整调仓频率
3. **交易成本优化**：引入缓冲区机制，减少不必要的调仓
4. **因子组合**：加入其他维度因子（如流动性、估值）提升选股能力

---

## 作者说明

本策略框架使用 `bt` (backtest) 库构建，具备良好的可扩展性。可根据实际需求调整参数或添加新策略模块。